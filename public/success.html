<!DOCTYPE html>
<html>

<head>
    <title>Sucesso - NextArc</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            padding: 50px;
            background: #121212;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80vh;
        }

        .btn {
            padding: 12px 24px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #357ae8;
        }

        .loader {
            border: 4px solid #333;
            border-top: 4px solid #4285f4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="loader"></div>
    <h1>Login Concluído!</h1>
    <p>Estamos te enviando de volta para o aplicativo NextArc...</p>
    <br>
    <a id="return-link" class="btn" href="#">Abrir Aplicativo Manualmente</a>

    <script>
        // 1. Extrai o token da URL (o Google manda após o #)
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const token = params.get('access_token');

        if (token) {
            // 2. Formata o link do protocolo customizado
            // Importante: nextarc://auth?token=...
            const deepLink = `nextarc://auth?token=${encodeURIComponent(token)}`;

            const linkElement = document.getElementById('return-link');
            linkElement.href = deepLink;

            // 3. Redirecionamento Automático
            // Tentamos disparar o link imediatamente
            window.location.href = deepLink;

            // 4. Fallback e fechamento
            // Se o usuário clicar ou o redirecionamento funcionar, tentamos fechar a aba em 5 segundos
            setTimeout(() => {
                if (!window.navigator.userAgent.includes('Electron')) {
                    // Tenta fechar a aba (só funciona se o script abriu a aba, mas vale a tentativa)
                    window.close();
                }
            }, 5000);
        } else {
            document.body.innerHTML = "<h1>Erro na Autenticação</h1><p>Não foi possível encontrar o token de acesso. Tente logar novamente.</p>";
        }
    </script>
</body>

</html>